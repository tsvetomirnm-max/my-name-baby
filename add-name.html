<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–æ–µ—Ç–æ –ò–º–µ ‚Äî –î–æ–±–∞–≤–∏ –∏–º–µ</title>
  <link rel="stylesheet" href="/assets/base.css">
</head>
<body>
  <div class="wrap">
    <nav class="nav">
      <div class="brand"><a href="/">–ú–æ–µ—Ç–æ –ò–º–µ</a></div>
      <div class="links">
        <a href="/">–ù–∞—á–∞–ª–æ</a>
        <a href="/add-name.html">–î–æ–±–∞–≤–∏ –∏–º–µ</a>
        <a href="/game.html">–ò–≥—Ä–∞</a>
        <a href="/about.html">–ó–∞ –Ω–∞—Å</a>
        <a href="/privacy.html">–ü–æ–≤–µ—Ä–∏—Ç–µ–ª–Ω–æ—Å—Ç</a>
      </div>
    </nav>

    <div class="card">
      <h1>–î–æ–±–∞–≤–∏ –Ω–æ–≤–æ –∏–º–µ</h1>
      <p class="muted">–ê–∫–æ –∏–º–µ—Ç–æ –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞, —â–µ –ø–æ–ª—É—á–∏—à —Å—ä–æ–±—â–µ–Ω–∏–µ.</p>
      <label>–ò–º–µ (–∫–∏—Ä–∏–ª–∏—Ü–∞)
        <input id="nm" type="text" placeholder="–Ω–∞–ø—Ä. –¢–µ–æ–¥–æ—Ä–∞">
      </label>
      <div class="radio-group">
        <input class="radio" type="radio" name="gender" id="a-m" value="m"><label for="a-m">–ú</label>
        <input class="radio" type="radio" name="gender" id="a-f" value="f"><label for="a-f">–ñ</label>
        <input class="radio" type="radio" name="gender" id="a-u" value="u"><label for="a-u">–ó–∞ –≤—Å–∏—á–∫–∏</label>
      </div>
      <button id="add">–î–æ–±–∞–≤–∏</button>
      <p id="ms" class="muted"></p>
    </div>
  </div>

  <script type="module">
    import { supabase, slugBg, isCyrillicName } from "/assets/app.js";
    const msg = document.getElementById("ms");
    document.getElementById("add").onclick = async ()=>{
      msg.className="muted"; msg.textContent="–ó–∞–ø–∏—Å–≤–∞–º–µ‚Ä¶";
      const display = document.getElementById("nm").value.trim();
      const g = (document.getElementById("a-m").checked && 'm') || (document.getElementById("a-f").checked && 'f') || (document.getElementById("a-u").checked && 'u') || "";
      if (!display || !g){ msg.className="err"; msg.textContent="–ú–æ–ª—è –≤—ä–≤–µ–¥–∏ –∏–º–µ –∏ –ø–æ–ª."; return; }
      if (!isCyrillicName(display)){ msg.className="err"; msg.textContent="–°–∞–º–æ –∫–∏—Ä–∏–ª–∏—Ü–∞ (2‚Äì60 –∑–Ω–∞–∫–∞)."; return; }
      const slug = slugBg(display);
      const { data, error } = await supabase.from("names").insert({ display, normalized_slug: slug, gender:g }).select("id").maybeSingle();
      if (error){
        if ((error.message||"").toLowerCase().includes("duplicate")){ msg.className="ok"; msg.textContent="–ò–º–µ—Ç–æ –≤–µ—á–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞."; }
        else { msg.className="err"; msg.textContent="–ì—Ä–µ—à–∫–∞: " + error.message; }
      } else { msg.className="ok"; msg.textContent="–î–æ–±–∞–≤–µ–Ω–æ! –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º üôå"; }
    };
  </script>
</body>
</html>
